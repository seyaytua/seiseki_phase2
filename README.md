# 成績管理システム Phase2

学校の成績データを管理するためのデスクトップアプリケーション（ワークフロー型）

## 概要

評定、観点別評価、欠課情報などの成績データをExcelファイルから取り込み、データベースで一元管理し、必要に応じて検索・出力できるシステムです。

## 技術スタック

- **UI**: PySide6 (Qt for Python)
- **データベース**: SQLite
- **データ処理**: pandas, openpyxl
- **言語**: Python 3.10+

## プロジェクト構造

```
phase2/
├── main.py                          # エントリーポイント
├── requirements.txt                 # 依存パッケージ
│
├── database/                        # データベース管理
│   └── db_manager.py
│
├── utils/                           # ユーティリティ
│   ├── config_manager.py           # 設定管理
│   ├── file_manager.py             # ファイル操作
│   ├── logger.py                   # ログ記録
│   ├── data_importer.py            # データ取り込み
│   ├── absence_processor.py        # 欠課集計★
│   ├── excel_exporter.py           # Excel出力
│   ├── excel_handler.py            # Excel操作
│   └── multi_sheet_handler.py      # 複数シート処理
│
├── ui/                              # ユーザーインターフェース
│   ├── main_window.py              # メインウィンドウ（ワークフロー型）
│   ├── absence_preprocessor_dialog.py  # 欠課前処理★
│   ├── column_mapping_dialog.py    # カラムマッピング
│   ├── period_import_dialog.py     # データ取り込み
│   ├── missing_entry_checker_dialog.py # 未入力者チェック★
│   ├── preset_manager_dialog.py    # プリセット管理
│   ├── preset_edit_dialog.py       # プリセット編集
│   ├── database_selector_dialog.py # データベース選択
│   ├── db_column_manager_dialog.py # DBカラム管理
│   ├── required_columns_manager_dialog.py # 必須カラム管理
│   └── log_viewer_dialog.py        # ログビューア
│
├── config/                          # 設定ファイル
│   ├── settings.json               # アプリ設定
│   ├── db_columns.json             # DBカラム定義
│   ├── column_mappings.json        # カラムマッピング
│   └── required_columns.json       # 必須カラム定義
│
└── data/                            # データ保存
    ├── database.db                 # SQLiteデータベース
    ├── imports/                    # 取り込みファイル
    └── exports/                    # 出力ファイル
```

## セットアップ

```bash
# 1. 依存パッケージのインストール
pip install -r requirements.txt

# 2. アプリケーションの起動
python main.py
```

## 主な機能

### 📥 データ取り込み（ワークフローSTEP 1-2）
- **評定データ取り込み**: 1-10の評価値を取り込み
- **観点別評価取り込み**: 観点1-5の評価を取り込み
- カラムマッピング機能（Excelのカラム名とDB項目の対応付け）
- 複数シート一括取り込み
- データプレビュー機能
- プリセット保存機能

### ⚠️ 未入力者チェック（ワークフローSTEP 3）★
- 評価・評定の未入力者確認
- 観点評価の未入力者確認
- 受講者マスタとの照合
- 未入力リストの出力

### 📊 欠課データ前処理（ワークフローSTEP 4）★
- **複数ファイルから欠課データを抽出・集計**
- 欠課略号の自動判定
- 欠課区分ごとの集計
- 複数シートの統合処理
- 処理ログのリアルタイム表示
- 集計結果のExcel出力

### ⚙️ システム管理
- **データベース選択**: マスタ管理アプリと共通DB利用可能
- **DBカラム管理**: データベースカラムのカスタマイズ
- **プリセット管理**: よく使う設定の保存・読み込み
- **カラムマッピング編集**: Excel⇔DB項目の対応設定
- **必須カラム管理**: 必須チェック項目の設定
- **操作ログ閲覧**: すべての操作履歴を記録・検索

## データベース構造

### grades（評定）
- 学籍番号、生徒名
- 科目番号、科目名、教科名
- 期間、年度
- 評定値、単位数、修得単位数

### viewpoint_evaluations（観点別評価）
- 学籍番号、生徒名
- 科目番号、科目名、教科名
- 期間、年度
- 観点1〜5（知識・技能、思考・判断・表現、主体的学習態度等）

### absences（欠課情報）★
- 学籍番号、生徒名
- 科目番号、科目名、教科名
- 期間、年度
- 欠席時数、遅刻時数、総時数、欠課率
- 欠課略号、欠課区分

### activity_logs（操作ログ）
- タイムスタンプ
- 操作種別
- 詳細情報

## ワークフローの流れ

```
STEP 1: 評価・評定データ取り込み
   ↓
STEP 2: 観点評価データ取り込み
   ↓
STEP 3: 未入力者チェック
   ↓
STEP 4: 欠課データ前処理（複数ファイルから集計）
   ↓
STEP 5: 欠課データ取り込み
   ↓
完了
```

## 特徴的な機能

### ⭐ 欠課集計機能（完璧な実装）
- 複数の出欠簿Excelファイルを一括処理
- 欠課略号の自動判定（病欠、出停、公欠、遅刻等）
- 欠課区分ごとの集計（欠席時数、遅刻時数）
- デバッグ情報の詳細表示
- 処理ログのリアルタイム表示

### プリセット機能
- よく使う設定を名前付きで保存
- ワンクリックで設定読み込み
- プリセットの編集・削除

### カラムマッピング
- Excelのカラム名が学校ごとに異なっても対応
- マッピング設定の保存・再利用
- プレビューで確認してから取り込み

### データベース選択
- マスタ管理アプリと共通のデータベースを利用可能
- 生徒マスタ、科目マスタ、受講者マスタとの連携

## 設定ファイル

### config/settings.json
アプリケーション全体の設定

### config/db_columns.json
データベースカラムの定義

### config/column_mappings.json
保存されたカラムマッピング

### config/required_columns.json
必須カラムの定義

## ライセンス

MIT License

## 作者

seyaytua

---

## 注意事項

- このアプリケーションは**ワークフロー型**で設計されています
- **欠課集計機能**は特に完璧に実装されており、複雑な処理も正確に行えます
- マスタ管理アプリと同じデータベースを使用することで、マスタデータを共有できます
